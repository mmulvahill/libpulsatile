% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_population.R
\name{fit_pulse_population}
\alias{fit_pulse_population}
\title{fit_pulse_population}
\usage{
fit_pulse_population(
  data,
  time = "time",
  conc = "concentration",
  subject_id = NULL,
  spec,
  subject_starts = NULL,
  iters = 250000,
  thin = 50,
  burnin = as.integer(0.1 * iters),
  use_tibble = TRUE,
  verbose = FALSE
)
}
\arguments{
\item{data}{A list of data frames, where each element corresponds to one
subject and contains columns for \code{time} and \code{concentration}.
Alternatively, a single data frame with a \code{subject_id} column.}

\item{time}{A string. Name of the time variable (default: "time").}

\item{conc}{A string. Name of the concentration variable (default: "concentration").}

\item{subject_id}{A string. Name of the subject ID variable if \code{data}
is a single data frame (default: NULL). If provided, data will be split
by this variable.}

\item{spec}{An object of class \code{population_spec}, created by
\code{population_spec()}, specifying priors, starting values, and proposal
variances for the population model.}

\item{subject_starts}{Optional list of subject-specific starting values. If
NULL, starting values will be initialized from population starting values
with small random perturbations. Each element should be a list with:
\code{baseline}, \code{halflife}, \code{mass_mean}, \code{width_mean}.}

\item{iters}{Number of MCMC iterations (default: 250000).}

\item{thin}{Thinning interval - save every \code{thin}th sample (default: 50).}

\item{burnin}{Number of initial samples to discard (default: 10%% of iters).}

\item{use_tibble}{Return chains as tibble data frames for prettier printing
(default: TRUE). Requires tibble package.}

\item{verbose}{Print diagnostic output every 5000 iterations including
parameter estimates and acceptance rates (default: FALSE).}
}
\value{
An object of class \code{population_fit} containing:
\itemize{
  \item \strong{model}: Model type ("population")
  \item \strong{call}: The matched call
  \item \strong{population_chain}: Data frame of population-level parameter samples
  \item \strong{subject_chains}: List of data frames, one per subject, with subject-level parameters
  \item \strong{pulse_chains}: List of lists - for each subject, a list of pulse parameter samples
  \item \strong{data}: The original data
  \item \strong{num_subjects}: Number of subjects
  \item \strong{options}: List of options used in fitting
  \item \strong{spec}: The specification object used
}
}
\description{
Fits a hierarchical Bayesian deconvolution model for pulsatile hormone data
from multiple subjects. This function estimates population-level parameters
(means and variances) as well as subject-specific and pulse-level parameters.
}
\details{
The population model estimates a three-level hierarchy:

\strong{Population Level:}
\itemize{
  \item Mean pulse mass and width across subjects
  \item Mean baseline and halflife across subjects
  \item Subject-to-subject SD of mean mass and width
  \item Subject-to-subject SD of baseline and halflife
  \item Pulse-to-pulse SD of mass and width (shared across subjects)
  \item Model error variance
}

\strong{Subject Level (for each subject):}
\itemize{
  \item Subject-specific mean pulse mass and width
  \item Subject-specific baseline and halflife
  \item Number of pulses (varies by MCMC iteration)
}

\strong{Pulse Level (for each pulse within each subject):}
\itemize{
  \item Individual pulse mass and width
  \item Pulse location (time)
  \item T-distribution scale parameters for pulse variability
}
}
\examples{
\dontrun{
# Simulate data for 5 subjects
set.seed(123)
sim_data <- lapply(1:5, function(i) {
  simulate_pulse(n_obs = 24, true_pulses = 12)$data
})

# Create specification
pop_spec <- population_spec(
  prior_mass_mean_mean = 3.5,
  prior_width_mean_mean = 42,
  prior_mean_pulse_count = 12
)

# Fit model
fit <- fit_pulse_population(
  data = sim_data,
  spec = pop_spec,
  iters = 10000,
  thin = 10,
  burnin = 5000,
  verbose = TRUE
)

# Examine results
summary(fit$population_chain)
plot(fit$population_chain$mass_mean, type = "l")
}
}
\keyword{population}
\keyword{pulse}
